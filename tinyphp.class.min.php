<?php
class tinyPhp{public $php_excludes=array('$GLOBALS','$_SERVER','$_GET','$_POST','$_FILES','$_REQUEST','$_SESSION','$_ENV','$_COOKIE','$php_errormsg','$HTTP_RAW_POST_DATA','$http_response_header','$argc','$argv');function is_label($a){return preg_match('~[a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*+~',$a);}function get_tiny($b,$c=FALSE,$d=FALSE,$e=FALSE,$f=array()){$php_excludes=$this->php_excludes;if(!empty($f)){$g=array_merge($php_excludes,$f);$g=array_unique($g);}else{$g=$php_excludes;}$h=token_get_all($b);$j=array();$k='';foreach($h as $l){if(!is_array($l)){$k.=$l;continue;}if($l[0]==T_VARIABLE&&!in_array($l[1],$g)){$j[]=$l[1];}if($e){if(in_array($l[0],array(T_COMMENT,T_DOC_COMMENT))){continue;}}$k.=$l[1];}$j=array_unique($j);if(!empty($j)){$m=array();$n=0;while($o=current($j)){$p=$n%26;$q=((int)floor($n/26))+1;$r=97+$p;$s=chr(36);for($t=1;$t<=$q;$t++){$s.=chr($r);}if(!in_array($s,$j)&&!in_array($s,$g)){$u[$o]=$s;next($j);}$n++;}}$h=token_get_all($k);$k='';foreach($h as $t=>$l){if(!is_array($l)){$k.=$l;continue;}if($c){if($l[0]==T_VARIABLE&&!in_array($l[1],$g)){$v=$l[1];$k.=$u[$v];continue;}}if($l[0]==T_WHITESPACE&&$d){if(isset($h[$t-1])&&isset($h[$t+1])&&is_array($h[$t-1])&&is_array($h[$t+1])&&$this->is_label($h[$t-1][1])&&$this->is_label($h[$t+1][1])){$k.=' ';}}elseif($l[0]==T_CASE){$k.=$l[1].' ';}else{$k.=$l[1];}}return htmlentities($k);}}